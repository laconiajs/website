<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>batch · Laconia</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Reads large number of records without Lambda time limit.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="batch · Laconia"/><meta property="og:type" content="website"/><meta property="og:url" content="https://laconiajs.io/index.html"/><meta property="og:description" content="&lt;p&gt;Reads large number of records without Lambda time limit.&lt;/p&gt;
"/><meta property="og:image" content="https://laconiajs.io/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://laconiajs.io/img/docusaurus.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs2015.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-137047564-1"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-137047564-1');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/laconia.svg" alt="Laconia"/><h2 class="headerTitleWithLogo">Laconia</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/introduction/getting-started" target="_self">Getting Started</a></li><li class="siteNavGroupActive"><a href="/docs/api/intro" target="_self">API</a></li><li class=""><a href="/help" target="_self">Help</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>API Reference</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/introduction/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/introduction/motivation">Motivation</a></li><li class="navListItem"><a class="navItem" href="/docs/introduction/core-concepts">Core Concepts</a></li><li class="navListItem"><a class="navItem" href="/docs/introduction/philosophy">Philosophy</a></li><li class="navListItem"><a class="navItem" href="/docs/introduction/examples">Examples</a></li><li class="navListItem"><a class="navItem" href="/docs/introduction/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/introduction/support-me">Support Me</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Laconia vs. Other</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/vs/claudia">Claudia</a></li><li class="navListItem"><a class="navItem" href="/docs/vs/express-koa">Express, Koa, Hapi, etc.</a></li><li class="navListItem"><a class="navItem" href="/docs/vs/middy">Middy</a></li><li class="navListItem"><a class="navItem" href="/docs/vs/serverless-sam">Serverless, SAM, Apex, etc.</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/guides/injecting-dependencies">Injecting Dependencies</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/unit-testing">Unit Testing</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/adapting-events">Adapting Events</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/creating-api-endpoints">Creating API Endpoints</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/retrieving-secrets">Retrieving Secrets</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/retrieving-config">Retrieving Config</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/warming-up">Warming Up</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/invoking-other-lambdas">Invoking Other Lambdas</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/long-running-tasks">Long Running Tasks</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/creating-middleware">Creating Middleware</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/api/intro">API Reference: Intro</a></li><li class="navListItem"><a class="navItem" href="/docs/api/core">core</a></li><li class="navListItem"><a class="navItem" href="/docs/api/event">event</a></li><li class="navListItem"><a class="navItem" href="/docs/api/adapter">adapter</a></li><li class="navListItem"><a class="navItem" href="/docs/api/adapter-api">adapter-api</a></li><li class="navListItem"><a class="navItem" href="/docs/api/invoker">invoker</a></li><li class="navListItem"><a class="navItem" href="/docs/api/config">config</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/api/batch">batch</a></li><li class="navListItem"><a class="navItem" href="/docs/api/middleware-lambda-warmer">middleware-lambda-warmer</a></li><li class="navListItem"><a class="navItem" href="/docs/api/middleware-serverless-plugin-warmup">middleware-serverless-plugin-warmup</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/laconiajs/website/edit/master/docs/api/batch.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">batch</h1></header><article><div><span><p>Reads large number of records without Lambda time limit.</p>
<h2><a class="anchor" aria-hidden="true" id="laconiabatchreaderlaconiacontext-batchoptions"></a><a href="#laconiabatchreaderlaconiacontext-batchoptions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>laconiaBatch(reader(laconiaContext), batchOptions)</code></h2>
<ul>
<li><code>reader(laconiaContext)</code>
<ul>
<li>This <code>Function</code> is called when your Lambda is invoked</li>
<li>The function must return a reader object, via <code>dynamoDb()</code>, <code>s3()</code></li>
<li>Will be called with <code>laconiaContext</code> object, which can be destructured to
<code>{event, context}</code></li>
</ul></li>
<li><code>batchOptions</code>
<ul>
<li><code>itemsPerSecond</code>
<ul>
<li><em>Optional</em></li>
<li>Rate limit will not be applied if value is not set</li>
<li>Can be set to decimal, i.e. 0.5 will equate to 1 item per 2 second.</li>
</ul></li>
<li><code>timeNeededToRecurseInMillis</code>
<ul>
<li><em>Optional</em></li>
<li>The value set here will be used to check if the current execution is to be
stopped</li>
<li>If you have a <em>very slow</em> item processing, the batch processor might not
have enough time to recurse and your Lambda execution might be timing out.
You can increase this value to increase the chance of the the recursion to
happen</li>
</ul></li>
</ul></li>
</ul>
<p>Creates a AWS Lambda handler that read records and let you process each items.
It will automatically recurse if the Lambda is about to time out and continue
where it left off.</p>
<p>Example:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> laconiaBatch = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@laconia/batch"</span>);

<span class="hljs-comment">// Use all default batch options (No rate limiting)</span>
exports.handler = laconiaBatch(<span class="hljs-function"><span class="hljs-params">_</span> =&gt;</span> laconiaBatch.dynamoDb());

<span class="hljs-comment">// Customise batch options</span>
exports.handler = laconiaBatch(<span class="hljs-function"><span class="hljs-params">_</span> =&gt;</span> laconiaBatch.dynamoDb(), {
  <span class="hljs-attr">itemsPerSecond</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">timeNeededToRecurseInMillis</span>: <span class="hljs-number">10000</span>
});
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="oneventname-listener"></a><a href="#oneventname-listener" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>on(eventName, listener)</code></h2>
<p>These are the events that you can listen to when <code>@laconia/batch</code> is running:</p>
<ul>
<li>item: <code>listener(laconiaContext, item)</code>
<ul>
<li>Fired on every item read.</li>
<li><code>item</code> is an object found during the read</li>
</ul></li>
<li>start: <code>listener(laconiaContext)</code>
<ul>
<li>Fired when the batch process is started for the very first time</li>
</ul></li>
<li>stop: <code>listener(laconiaContext, cursor)</code>
<ul>
<li>Fired when the current execution is timing out and about to be recursed</li>
<li><code>cursor</code> contains the information of how the last item is being read</li>
</ul></li>
<li>end: <code>listener(laconiaContext)</code>
<ul>
<li>Fired when the batch processor can no longer find any more records</li>
</ul></li>
</ul>
<p>Example:</p>
<pre><code class="hljs css language-js">laconiaBatch()
  .on(<span class="hljs-string">"start"</span>, laconiaContext =&gt; {})
  .on(<span class="hljs-string">"item"</span>, (laconiaContext, item) =&gt; {})
  .on(<span class="hljs-string">"stop"</span>, (laconiaContext, cursor) =&gt; {})
  .on(<span class="hljs-string">"end"</span>, laconiaContext =&gt; {});
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="dynamodbreaderoptions"></a><a href="#dynamodbreaderoptions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>dynamoDb(readerOptions)</code></h2>
<p>Creates a reader for a DynamoDB table.</p>
<ul>
<li><code>operation</code>
<ul>
<li><em>Mandatory</em></li>
<li>Valid values are: <code>'SCAN'</code> and <code>'QUERY'</code></li>
</ul></li>
<li><code>dynamoDbParams</code>
<ul>
<li><em>Mandatory</em></li>
<li>This parameter is used when documentClent's operations are called</li>
<li><code>ExclusiveStartKey</code> param can't be used as it will be overridden in the
processing time!</li>
</ul></li>
<li><code>documentClient = new AWS.DynamoDB.DocumentClient()</code>
<ul>
<li><em>Optional</em></li>
<li>Set this option if there's a need to cutomise the
AWS.DynamoDB.DocumentClient instantation</li>
<li>Used for DynamoDB operation</li>
</ul></li>
</ul>
<p>Example:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Scans the entire Music table</span>
dynamoDb({
  <span class="hljs-attr">operation</span>: <span class="hljs-string">"SCAN"</span>,
  <span class="hljs-attr">dynamoDbParams</span>: { <span class="hljs-attr">TableName</span>: <span class="hljs-string">"Music"</span> }
});

<span class="hljs-comment">// Queries Music table with a more complicated DynamoDB parameters</span>
dynamoDb({
  <span class="hljs-attr">operation</span>: <span class="hljs-string">"QUERY"</span>,
  <span class="hljs-attr">dynamoDbParams</span>: {
    <span class="hljs-attr">TableName</span>: <span class="hljs-string">"Music"</span>,
    <span class="hljs-attr">Limit</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">ExpressionAttributeValues</span>: {
      <span class="hljs-string">":a"</span>: <span class="hljs-string">"Bar"</span>
    },
    <span class="hljs-attr">FilterExpression</span>: <span class="hljs-string">"Artist = :a"</span>
  }
});
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="s3readeroptions"></a><a href="#s3readeroptions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>s3(readerOptions)</code></h2>
<p>Creates a reader for an array stored in s3.</p>
<ul>
<li><code>path</code>
<ul>
<li><em>Mandatory</em></li>
<li>The path to the array to be processed</li>
<li>Set to <code>'.'</code> if the object stored in s3 is the array</li>
<li>Set to a path if an object is stored in s3 and the array is a property of
the object
<ul>
<li><code>lodash.get</code> is used to retrieve the array</li>
</ul></li>
</ul></li>
<li><code>s3Params</code>
<ul>
<li><em>Mandatory</em></li>
<li>This parameter is used when <code>s3.getObject</code> is called to retrieve the array
stored in s3</li>
</ul></li>
<li><code>s3 = new AWS.S3()</code>
<ul>
<li><em>Optional</em></li>
<li>Set this option if there's a need to cutomise the AWS.S3 instantation</li>
<li>Used for S3 operation</li>
</ul></li>
</ul>
<p>Example:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Reads an array from array.json in MyBucket</span>
s3({
  <span class="hljs-attr">path</span>: <span class="hljs-string">"."</span>,
  <span class="hljs-attr">s3Params</span>: {
    <span class="hljs-attr">Bucket</span>: <span class="hljs-string">"MyBucket"</span>,
    <span class="hljs-attr">Key</span>: <span class="hljs-string">"array.json"</span>
  }
});

<span class="hljs-comment">// Reads the array retrieved at database.music[0]["category"].list from object.json in MyBucket</span>
s3({
  <span class="hljs-attr">path</span>: <span class="hljs-string">'database.music[0]["category"].list'</span>,
  <span class="hljs-attr">s3Params</span>: {
    <span class="hljs-attr">Bucket</span>: <span class="hljs-string">"MyBucket"</span>,
    <span class="hljs-attr">Key</span>: <span class="hljs-string">"object.json"</span>
  }
});
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/api/config"><span class="arrow-prev">← </span><span>config</span></a><a class="docs-next button" href="/docs/api/middleware-lambda-warmer"><span>middleware-lambda-warmer</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#laconiabatchreaderlaconiacontext-batchoptions"><code>laconiaBatch(reader(laconiaContext), batchOptions)</code></a></li><li><a href="#oneventname-listener"><code>on(eventName, listener)</code></a></li><li><a href="#dynamodbreaderoptions"><code>dynamoDb(readerOptions)</code></a></li><li><a href="#s3readeroptions"><code>s3(readerOptions)</code></a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/laconia.svg" alt="Laconia" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/introduction/getting-started">Getting Started</a><a href="/docs/en/introduction/core-concepts">Core Concepts</a><a href="/docs/en/api/intro">API Reference</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/laconiajs" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://gitter.im/laconiajs/laconia">Chat</a></div><div><h5>More</h5><a href="https://twitter.com/laconiajs" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://github.com/laconiajs/laconia">GitHub</a><a class="github-button" href="https://github.com/laconiajs/laconia" data-icon="octicon-star" data-count-href="/laconiajs/laconia/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Wisen Tanasa</section><section class="copyright">Logo designed by <a href="https://www.linkedin.com/in/suzie-nam-471980b7/">Suzie Nam</a></section></footer></div></body></html>